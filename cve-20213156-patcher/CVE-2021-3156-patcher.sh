#!/bin/bash
echo "PATCHING CVE-2021-3156"
echo "`whoami`, YOU MUST BE A SUDOER TO RUN THIS."
sleep 3
echo ""
tar xzvf sudo-1.9.5p2.tar.gz
cd sudo-1.9.5p2
echo ""
./configure
echo ""
make && sudo make install
echo "=========================================================="
if bash -c "sudo --version" | grep -q '1.9.5p2'; then
   echo "SUCCESS! YOUR MACHINE HAS BEEN PATCHED SUCCESSFULLY, `whoami`. STAY SAFE. =)"
else
   echo "FAILURE! PATCHING FAILED. CHECK OUTPUT FOR ANYTHING UNUSUAL. PATCH THIS BUG ASAP!"
fi

echo "=========================================================="
sleep 3
cd ..
rm sudo-1.9.5p2.tar.gz
rm ./sudo-1.9.5p2 -rf
bash
